更新了下划线命名规则

# 更新后的CUHKSZ宿舍管理系统接口文档
## 基础信息
+ **技术栈**: Java Spring Boot + MySQL + 前端静态页面
+ **接口格式**: RESTful API
+ **数据格式**: JSON
+ **认证方式**: Session认证（登录后保存用户信息到Session）

---

## 统一响应格式
```json
{
  "code": 1,        // 0代表失败，1代表成功
  "message": "success",
  "data": null      // 或者其他需要返回的数据
}
```

---

## 学生端接口
### 1. 账户管理
#### 1.1 学生注册
+ **URL**: `/student/register`
+ **方法**: POST
+ **请求参数**:

```json
{
  "student_id": "string",
  "password": "string",
  "name": "string",
  "gender": "MALE",
  "email": "string",
  "phone": "string"
}
```

+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": null
}
```

#### 1.2 学生登录&登出
+ **URL**: `/student/login`
+ **方法**: POST
+ **请求参数**:

```json
{
  "student_id": "string",
  "password": "string"
}
```

+ **响应**:

```json
{
  "code": 1,
  "message": "登录成功",
  "data": {
    "id": 1,
    "student_id": "12345678",
    "name": "张三",
    "gender": "MALE",
    "email": "zhangsan@link.cuhk.edu.cn",
    "phone": "13800138001"
  }
}
```

+ **登出URL**: `/logout`
+ **方法**：POST
+ 不需要请求参数，学生和管理员登出都使用这个接口
+ **响应**:

```json
{
  "code": 1,
  "message": "退出登录成功",
  "data": null
}
```

#### 1.3 修改个人信息
+ **URL**: `/student/profile`
+ **方法**: PUT
+ **请求参数**:

```json
{
  "password": "string",
  "email": "string",
  "phone": "string"
}
```

+ **响应**:

```json
{
  "code": 1,
  "message": "更新成功"
  "data": null
}
```

#### 1.4 获取当前登录学生信息
+ **URL**: `/student/current`
+ **方法**: GET
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": {
    "id": 1,
    "student_id": "12345678",
    "name": "张三",
    "gender": "MALE",
    "email": "zhangsan@link.cuhk.edu.cn",
    "phone": "13800138001",
    "role": "STUDENT",
    "created_at": "LocalDateTime",
    "updated_at": "LocalDateTime"
  }
}
```

### 2. 住宿信息
#### 2.1 查看我的宿舍分配详情
+ **URL**: `/student/dorm_info`
+ **方法**: GET
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": {
    "building_name": "逸夫书院D栋",
    "room_number": "609",
    "roommates": [
      {
        "name": "Zhou Yifan",
        "student_id": "123090910",
        "gender": "MALE",
        "email": "yifanzhou2@link.cuhk.edu.cn",
        "phone": "13700000000"
      },
      {
        "name": "张三",
        "student_id": "123456789",
        "gender": "MALE",
        "email": "zhangsan@link.cuhk.edu.cn",
        "phone": "13800138001"
      }
    ]
  }
}
```

### 3. 申请服务
#### 3.1 提交宿舍调整申请
+ **系统先获取获取所有楼栋信息待选**
+ **URL**: `/student/buildings`
+ **方法**: GET
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": [
    "逸夫书院D栋",
    "逸夫书院C栋"
  ]
}
```



+ **提交宿舍调整申请**
+ **URL**: `/student/adjustment_request`
+ **方法**: POST
+ **请求参数**:

```json
{
  "reason": "希望更换到安静的房间",
  "preferred_building_name": "逸夫书院D栋"
}
```

+ **响应**:

```json
{
  "code": 1,
  "message": "申请提交成功",
  "data": null
}
```

#### 3.2 查看我的申请
+ **URL**: `/student/my_requests`
+ **方法**: GET
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": [
    {
      "student_id": "20000",
      "reason": "希望更换到安静的房间"
      "preferred_building_name": "逸夫书院C栋",
      "status": "PENDING",
      "admin_notes": null,
      "assigned_room_number": null,
      "create_time": "2024-01-15 10:30:00",
      "update_time": "2024-01-15 10:30:00"
    }
  ]
}
```

### 4. 费用查询
#### 4.1 查看我的宿舍费用
+ **URL**: `/student/fees`
+ **方法**: GET
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": {
    "student_id": "123456789",
    "academic_year": "2023-2024",
    "semester": "SPRING",
    "accommodation_fee": 1500.00,
    "electricity_fee": 80.00,
    "total_amount": 1580.00,
    "due_date": "2024-02-01",
    "paid": false
    "paid_date": null
  }
}
```

### 5. 维修服务
#### 5.1 提交维修请求
+ **URL**: `/student/maintenance`
+ **方法**: POST
+ **请求参数**:

```json
{
  "issue_type": "PLUMBING", // PLUMBING, ELECTRICAL, FURNITURE, OTHER
  "description": "卫生间水龙头漏水"
}
```

+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": null
}
```

#### 5.2 查看我的维修请求
+ **URL**: `/student/maintenance`
+ **方法**: GET
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": [
    {
      "student_id": "20000",
      "room_id": 16,
      "issue_type": "PLUMBING",
      "description": "卫生间水龙头漏水",
      "status": "SUBMITTED",
      "maintenance_notes": null,
      "estimated_completion": null,
      "created_at": "2024-01-15 14:20:00",
      "updated_at": "2024-01-15 14:20:00"
    }
  ]
}
```



---

## 管理员端接口
### 1. 账户管理
#### 1.1 管理员登录
+ **注：管理员注册使用 /admin/register ， 底层逻辑和学生注册一样，请求参数为：**

```json
{
  "student_id": "string",  // 可以为任意字符比如"admin001"
  "password": "string",
  "name": "string",
  "gender": "MALE",
  "email": "string",
  "phone": "string"
}
```

+ **管理员注册的接口不向前端静态页面开放，前端页面只能登录**



+ **管理员登录：**
+ **URL**: `/admin/login`
+ **方法**: POST
+ **请求参数**:

```json
{
  "student_id": "string",
  "password": "string"
}
```

+ **响应**:

```json
{
  "code": 1,
  "message": "登录成功",
  "data": {
    "id": 1,
    "student_id": "admin",
    "name": "headmaster",
    "gender": "MALE",
    "email": "headmaster@cuhk.edu.cn",
    "phone": "13800138000"
  }
}
```

#### 1.2 获取当前管理员信息
+ **URL**: `/admin/current`
+ **方法**: GET
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": {
    "id": 1,
    "username": "admin",
    "name": "headmaster",
    "gender": "MALE",
    "email": "headmaster@cuhk.edu.cn",
    "phone": "13800138000"
  }
}
```

#### 1.3 修改管理员个人信息
+ **URL**: `/admin/profile`
+ **方法**: PUT
+ **请求参数**:

```json
{
  "password": "string",
  "email": "string",
  "phone": "string"
}
```

+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": null
}
```

### 2. 申请处理
#### 2.1 获取申请列表
+ **URL**: `/admin/adjustment_requests`
+ **方法**: GET
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": [
    {
      "id": 1,
      "student_id": "123456789",
      "reason": "希望更换到安静的房间",
      "preferred_building_name": "逸夫书院D栋",
      "status": "APPROVED",
      "admin_notes": "申请已批准，分配到新房间",
      "assigned_room_number": "205",
      "created_at": "2025-11-10T22:00:49",
      "updated_at": "2025-11-19T20:50:55"
    }
  ]
}
```

#### 2.2 处理宿舍调整申请
+ **URL**: `/admin/handle_adjustment/{request_id}`
+ **方法**: POST
+ **请求参数**:

```json
{
  "status": "APPROVED", // APPROVED or REJECTED
  "admin_notes": "申请已批准，分配到新房间",
  "assigned_room_id": 205  // 如果批准，需要分配的房间ID；拒绝则不需要
}
```

+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": null
}
```

### 3. 状态监控
#### 3.1 查看所有宿舍状态
+ 先实现一个building_id与building_name的对应关系查询，以实现后续查询的下拉菜单
+ URL: `/admin/buildings`
+ **方法**: GET
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": [
    {
      "building_id": 1,
      "building_name": "逸夫书院D栋"
    },
    {
      "building_id": 2,
      "building_name": "逸夫书院E栋"
    }
  ]
}
```



+ **URL**: `/admin/dorm_status`
+ **方法**: GET
+ **查询参数**: `building_id` (可选)
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": [
    {
      "building_id": 1,
      "building_name": "逸夫书院D栋",
      "room_number": "609",
      "current_occupants": 4,
      "students": [
        {
          "student_id": "123090910",
          "name": "Zhou Yifan"
        },
        {
          "student_id": "123456789",
          "name": "张三"
        }
      ]
    }
  ]
}
```

#### 3.2 查看缴费状态
+ **URL**: `/admin/fee_status`
+ **方法**: GET
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": [
    {
      "student_id": "123456789",
      "room_id": 10,
      "building_id": 1,
      "building_name": "逸夫书院D栋",
      "room_number": "609",
      "academic_year": "2023-2024",
      "semester": "SPRING",
      "total_amount": 1580.00,
      "paid": false,
      "due_date": "2024-02-01",
      "paid_date": null
    }
  ]
}
```

### 4. 维修管理
#### 4.1 获取维修请求列表
+ **URL**: `/admin/maintenance_requests`
+ **方法**: GET
+ **查询参数**: `status` (可选: SUBMITTED, IN_PROGRESS, COMPLETED)（无参数则默认查询所有）
+ **响应**:

```json
{
  "code": 1,
  "message": "success",
  "data": [
    {
      "id": 1,
      "student_id": "123456789",
      "room_id": 10,
      "issue_type": "PLUMBING",
      "description": "卫生间水龙头漏水",
      "status": "SUBMITTED",
      "maintenance_notes": "已更换管道"，
      "estimated_completion": "2024-01-16",
      "created_at": "2024-01-15 14:20:00",
      "updated_at": "2024-01-15 14:20:00"
    }
  ]
}
```

#### 4.2 更新维修状态
+ **URL**: `/admin/maintenance_request/{id}`
+ **方法**: PUT
+ **请求参数**:

```json
{
  "status": "IN_PROGRESS", // IN_PROGRESS, COMPLETED
  "maintenance_notes": "已派维修人员处理",
  "estimated_completion": "2024-01-16"
}
```

+ **响应**:

```json
{
  "code": 1,
  "message": "更新成功",
  "data": null
}
```

---

## 关于Session管理的说明
对于学生身份识别，实现方案如下：

1. **登录时保存用户信息到Session**：

```java
// 登录成功后
session.setAttribute("student_id", user.getStudent_id());
session.setAttribute("user_id", user.getId());
session.setAttribute("role", "STUDENT");
```

2. **在需要学生身份的方法中从Session获取**：

```java
// 在Controller方法中
@GetMapping("/student/dorm_info")
public ApiResponse getDormInfo(HttpSession session) {
    String student_id = (String) session.getAttribute("student_id");
    if (student_id == null) {
        return ApiResponse.error("未登录");
    }
    // 使用student_id查询宿舍信息
    return studentService.getDormInfo(student_id);
}
```

---

## 错误码说明
| code | 说明 |
| --- | --- |
| 0 | 操作失败 |
| 1 | 操作成功 |


---



